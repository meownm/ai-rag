#!/bin/bash
# scripts/setup-dev-wsl.sh
# –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –Ω—É–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –≤–Ω—É—Ç—Ä–∏ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ WSL (Ubuntu).

# –ü—Ä–µ—Ä—ã–≤–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏ –ª—é–±–æ–π –æ—à–∏–±–∫–µ
set -e

echo "--- –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ ROCm (–¥—Ä–∞–π–≤–µ—Ä—ã –¥–ª—è AMD GPU) ---"
# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ª–∏ rocminfo
if ! command -v rocminfo &> /dev/null
then
    echo "ROCm –Ω–µ –Ω–∞–π–¥–µ–Ω. –ù–∞—á–∏–Ω–∞–µ–º —É—Å—Ç–∞–Ω–æ–≤–∫—É..."
    sudo apt update
    sudo apt install -y rocm-hip-sdk rocminfo
    echo "–î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥—Ä—É–ø–ø—ã 'render' –∏ 'video'..."
    sudo usermod -aG render $LOGNAME
    sudo usermod -aG video $LOGNAME
    echo "---------------------------------------------------------"
    echo "–í–ê–ñ–ù–û! –£—Å—Ç–∞–Ω–æ–≤–∫–∞ ROCm –∑–∞–≤–µ—Ä—à–µ–Ω–∞."
    echo "–ß—Ç–æ–±—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—Å—Ç—É–ø–∏–ª–∏ –≤ —Å–∏–ª—É, –ü–û–õ–ù–û–°–¢–¨–Æ –ó–ê–ö–†–û–ô–¢–ï —ç—Ç–æ—Ç —Ç–µ—Ä–º–∏–Ω–∞–ª –∏ –æ—Ç–∫—Ä–æ–π—Ç–µ –Ω–æ–≤—ã–π."
    echo "–ó–∞—Ç–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç–µ —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –µ—â–µ —Ä–∞–∑."
    echo "---------------------------------------------------------"
    exit 0
else
    echo "ROCm —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω."
fi

echo ""
echo "--- –®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Poetry (–º–µ–Ω–µ–¥–∂–µ—Ä –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π) ---"
if ! command -v poetry &> /dev/null
then
    echo "Poetry –Ω–µ –Ω–∞–π–¥–µ–Ω. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º..."
    curl -sSL https://install.python-poetry.org | python3 -
    # –î–æ–±–∞–≤–ª—è–µ–º Poetry –≤ PATH –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏
    export PATH="$HOME/.local/bin:$PATH"
else
    echo "Poetry —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω."
fi

echo ""
echo "--- –®–∞–≥ 3: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –ø—Ä–æ–µ–∫—Ç–∞ ---"
echo "–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–∞–∫–µ—Ç—ã –∏–∑ pyproject.toml (—ç—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –≤—Ä–µ–º—è)..."
poetry install

echo ""
echo "---------------------------------------------------------"
echo "üéâ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! üéâ"
echo "–î–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É:"
echo "./scripts/run-dev.sh"
echo "---------------------------------------------------------"