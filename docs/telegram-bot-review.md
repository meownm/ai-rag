# Telegram bot code review

## Главные проблемы
- **Кнопки действий ломаются, если API поиск не поддерживает UUID.** В `button_callback_handler` бот ищет объект по UUID через `/items/search`, а затем берёт первый результат. Если поиск принимает текстовое имя (как в цепочке вызовов), кнопка «Действия/скачать/изменить статус» не найдёт элемент и покажет «Элемент был удален или изменен», хотя объект существует; при нескольких совпадениях может выбрать не тот документ. Нужен отдельный вызов "get by id" и проверка, что найден ровно один объект.
- **HTTP-клиенты не закрываются.** `KnowledgeBaseAPI` создаёт два `httpx.AsyncClient`, но нигде не вызывает `aclose()` на остановке приложения. После нескольких рестартов процесс может держать открытые соединения/сокеты, а в тестах — утечки ресурсов. Следует добавить хуки запуска/остановки бота для аккуратного закрытия клиентов.
- **Кнопка удаления не проверяет существование элемента перед запросом.** Ветвь `delete_execute` вызывает `delete_item` без предварительной проверки, хотя выше бот может уже решить, что объект отсутствует. Это усложняет пользователю понимание ошибки и перекладывает обработку на API; стоит повторно получать элемент или явно информировать пользователя, если элемент не найден перед удалением.

## Дополнительные замечания
- **Отсутствует ограничение размера/типа файла.** В `document_handler` бот принимает любой документ без проверки размера или допустимых расширений, передавая его целиком в API. Это может вызвать отказ сервиса или превышение лимитов Telegram. Желательно валидировать метаданные файла до загрузки.
- **Нет таймаута/обработки ошибок при длительных callback-операциях.** Действия «скачать» и «изменить статус» полностью полагаются на API-ответ; при задержках пользователь увидит только общий ответ из глобального обработчика. Можно добавить явное уведомление о повторной попытке или спиннер, а также логировать статусные кодов API.
