# OCR варианты: Tesseract (текущий), PaddleOCR, EasyOCR

Этот проект сейчас использует **Tesseract** как резервный OCR в document-processor (PDF c пустыми страницами и изображения в DOCX). Ниже — сравнение локальных альтернатив с таблицами, чек-листами и готовыми сценариями выбора.

## Сводная таблица различий
| Критерий | Tesseract (текущий) | PaddleOCR | EasyOCR |
| --- | --- | --- | --- |
| Лицензия/стоимость | Бесплатный, уже включён в образ | Бесплатный, Apache 2.0 | Бесплатный, Apache 2.0 |
| Точность на кириллице | Базовая, зависит от качества | Выше за счёт готовых моделей и детекции | Обычно выше Tesseract, но ниже PaddleOCR на сложных макетах |
| Поддержка структуры | Не восстанавливает макет | Есть детектор и рекогнайзер, можно извлекать блоки | Ограниченная, фокус на строках |
| Скорость / аппаратная поддержка | CPU, без GPU | Есть GPU (CUDA), быстрее на батчах | Есть GPU, но медленнее PaddleOCR на больших партиях |
| Зависимости | Минимальные, уже установлены | Требуются дополнительные модели/библиотеки, больше размер образа | Лёгкие модели, но меньше гибкости |
| Настройка языков | Через языковые пакеты `langdata` | Автоопределение + модели для нескольких языков | Список поддерживаемых языков, автоопределение ограничено |

## Чек-листы применения
### Когда оставлять Tesseract
- ✅ Редкий fallback на сканах/пустых страницах, когда важнее минимальные зависимости.
- ✅ Ограниченные ресурсы или строгий размер образа.
- ✅ Нет требований к восстановлению сложной структуры.

### Когда рассмотреть PaddleOCR
- ✅ Большой поток сканов или сложная верстка, где нужна лучшая точность и скорость.
- ✅ Есть GPU и возможность подтянуть более тяжёлые модели.
- ✅ Требуется детекция блоков/таблиц и сохранение структуры.

### Когда рассмотреть EasyOCR
- ✅ Нужен компромисс между качеством и лёгкостью установки без больших моделей.
- ✅ Есть GPU, но нет требований к детальному восстановлению макета.
- ✅ Требуется минимум зависимостей при чуть лучшем качестве, чем у Tesseract.

## Карта решений по сценариям
| Сценарий | Рекомендованный backend | Пояснение |
| --- | --- | --- |
| Небольшие объёмы, OCR только как резерв | Tesseract | Уже встроен, минимальный размер образа |
| Массовая обработка сканов с GPU | PaddleOCR | Лучшая точность/скорость на батчах, сохранение структуры |
| Нет GPU, но нужна чуть лучшая точность | EasyOCR | Простая установка, лучше Tesseract на части кейсов |
| Требуется сохранить блоки/таблицы | PaddleOCR | Есть детектор и сегментация макета |

## План интеграции (по шагам)
1. **Выбранный backend**: для балансировки качества/простоты выбрана **EasyOCR** как основной настраиваемый вариант (`OCR_BACKEND=easyocr`), Tesseract остаётся fallback-ом.
2. **Конфигурация**: backend задаётся через `.env` (`OCR_BACKEND=tesseract|easyocr`, `OCR_ENABLED`, `OCR_LANG`), чтобы можно было переключаться без изменения кода.
3. **Адаптеры**: `parser_any.py` и `parser_docx.py` вызывают `ocr_image_to_text` с lazy-инициализацией EasyOCR; при ошибке EasyOCR происходит автоматический откат на Tesseract.
4. **Установка и зависимости**: добавлены системные пакеты (`libgl1`, `libglib2.0-0`) и зависимость `easyocr` в `pyproject.toml`, Dockerfile document-processor устанавливает их по умолчанию.
5. **Предобработка**: для повышения качества Tesseract можно дополнительно включить binarization/deskew на уровне изображений (опционально, без изменения выбранного backend).

## Быстрые ссылки
- Пайплайн: document-processor → OCR fallback → разбор в markdown.
- Настройки: переменные `OCR_ENABLED`, `OCR_LANG` и будущий `OCR_BACKEND`.
